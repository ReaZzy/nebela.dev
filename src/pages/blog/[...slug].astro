---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { formatDate } from "@/utils/format-date";
import RandomAsciiImage from "@/components/ascii/random-ascii-image";
import { ASCII_IMAGE_PATHS } from "@/components/ascii/constants/random-ascii-images.config";
import AttachCopyToCode from "@/components/blog/AttachCopyToCode.astro";
import AttachAnchors from "@/components/blog/AttachAnchors.astro";
import { ME } from "@/constants/me";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} | ${ME.name}`} description={post.data.description}>
  <div class="relative z-10 min-h-screen flex flex-col">
    <Header currentPage="blog" />

    <main class="w-full max-w-4xl mx-auto px-4 pb-8 flex-1" transition:name="main-content">
      <a
        href="/blog"
        data-astro-navigate
        class="inline-block mb-4 font-mono text-base text-zinc-400 hover:text-green-400 active:text-green-400 transition-colors duration-200"
      >
        ← back to all posts
      </a>
      <article class="prose max-w-none">
        <header class="mb-8 not-prose">
          <h1 class="font-mono text-2xl md:text-3xl mb-2 text-zinc-100">{post.data.title}</h1>
          <time datetime={post.data.date.toISOString()} class="font-mono text-sm text-zinc-400">
            {formatDate(post.data.date)}
          </time>
        </header>
        <Content />
      </article>
      <a
        href="/blog"
        data-astro-navigate
        class="inline-block mt-8 font-mono text-base text-zinc-400 hover:text-green-400 active:text-green-400 transition-colors duration-200"
      >
        ← back to all posts
      </a>
    </main>

    <Footer />
  </div>
  <RandomAsciiImage client:idle images={ASCII_IMAGE_PATHS.blog} className="opacity-40" />
  <AttachCopyToCode />
  <AttachAnchors />
</Layout>
